<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PEN Form Management System">
    <meta name="theme-color" content="#1a1a1a">
    <title>PEN - Form Manager</title>
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlBFTiAtIEZvcm0gTWFuYWdlciIsCiAgInNob3J0X25hbWUiOiAiUEVOIEZvcm1zIiwKICAiZGVzY3JpcHRpb24iOiAiUGFydGljaXBhdGUsIEVudmlzaW9uLCBOYXZpZ2F0ZSAtIEZvcm0gTWFuYWdlbWVudCIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZmZmZmZiIsCiAgInRoZW1lX2NvbG9yIjogIiMxYTFhMWEiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgd2lkdGg9JzE5MicgaGVpZ2h0PScxOTInJTNFJTNDcmVjdCB3aWR0aD0nMTkyJyBoZWlnaHQ9JzE5MicgZmlsbD0nJTIzMWExYTFhJy8lM0UlM0N0ZXh0IHg9JzUwJTI1JyB5PSc1MCUyNScgZm9udC1zaXplPSc4MCcgZm9udC13ZWlnaHQ9JzYwMCcgZmlsbD0nd2hpdGUnIHRleHQtYW5jaG9yPSdtaWRkbGUnIGR5PScuMzVlbScgZm9udC1mYW1pbHk9J3NhbnMtc2VyaWYnJTNFUEVOJTNDL3RleHQlM0UlM0Mvc3ZnJTNFIiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgd2lkdGg9JzUxMicgaGVpZ2h0PSc1MTInJTNFJTNDcmVjdCB3aWR0aD0nNTEyJyBoZWlnaHQ9JzUxMicgZmlsbD0nJTIzMWExYTFhJy8lM0UlM0N0ZXh0IHg9JzUwJTI1JyB5PSc1MCUyNScgZm9udC1zaXplPScyMjAnIGZvbnQtd2VpZ2h0PSc2MDAnIGZpbGw9J3doaXRlJyB0ZXh0LWFuY2hvcj0nbWlkZGxlJyBkeT0nLjM1ZW0nIGZvbnQtZmFtaWx5PSdzYW5zLXNlcmlmJyUzRVBFTiUzQy90ZXh0JTNFJTNDL3N2ZyUzRSIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0KICBdCn0=">
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; padding: 0; font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        canvas { touch-action: none; }
        
        .container { min-height: 100vh; background: #f5f5f5; padding: 1rem; }
        .max-w { max-width: 72rem; margin: 0 auto; }
        .card { background: white; border-radius: 0.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 1.5rem; margin-bottom: 1.5rem; }
        
        .btn { padding: 0.5rem 1rem; border-radius: 0.375rem; border: none; cursor: pointer; font-size: 0.875rem; font-weight: 500; display: inline-flex; align-items: center; gap: 0.5rem; transition: all 0.2s; }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-primary { background: #1a1a1a; color: white; }
        .btn-success { background: #059669; color: white; }
        .btn-danger { background: #dc2626; color: white; }
        .btn-gray { background: #6b7280; color: white; }
        .btn-light { background: #e5e7eb; color: #374151; }
        
        .pen-header { background: #1a1a1a; color: white; padding: 1.5rem; border-radius: 0.5rem; margin-bottom: 1.5rem; }
        .pen-logo { font-size: 2rem; font-weight: 600; letter-spacing: 0.05em; }
        .pen-tagline { font-size: 0.875rem; opacity: 0.9; margin-top: 0.25rem; }
        
        .input, .select, .textarea { width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem; }
        .input:focus, .select:focus, .textarea:focus { outline: none; border-color: #1a1a1a; box-shadow: 0 0 0 3px rgba(26,26,26,0.1); }
        
        .grid { display: grid; gap: 1rem; }
        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
        .grid-3 { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
        
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .flex-1 { flex: 1; }
        
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        
        .border { border: 1px solid #e5e7eb; }
        .border-2 { border: 2px solid #d1d5db; }
        .rounded { border-radius: 0.375rem; }
        .rounded-lg { border-radius: 0.5rem; }
        
        .p-1 { padding: 0.25rem; }
        .p-2 { padding: 0.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
        
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .ml-4 { margin-left: 1rem; }
        
        .text-xs { font-size: 0.75rem; line-height: 1rem; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
        
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        
        .text-gray-500 { color: #6b7280; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-800 { color: #1f2937; }
        .text-gray-900 { color: #111827; }
        .text-blue-600 { color: #2563eb; }
        .text-red-500 { color: #ef4444; }
        .text-red-600 { color: #dc2626; }
        .text-red-800 { color: #991b1b; }
        
        .bg-white { background: white; }
        .bg-gray-50 { background: #f9fafb; }
        .bg-blue-50 { background: #eff6ff; }
        .bg-pen-light { background: #f5f5f5; }
        
        .hover\:bg-gray-50:hover { background: #f9fafb; }
        .hover\:shadow-md:hover { box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        
        .relative { position: relative; }
        .absolute { position: absolute; }
        .top-2 { top: 0.5rem; }
        .right-2 { right: 0.5rem; }
        
        .w-full { width: 100%; }
        .cursor-crosshair { cursor: crosshair; }
        .whitespace-nowrap { white-space: nowrap; }
        .transition-shadow { transition: box-shadow 0.2s; }
        
        .border-pen { border-color: #1a1a1a; }
        .border-blue-200 { border-color: #bfdbfe; }
        
        .fullscreen-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: white; z-index: 9999; display: flex; flex-direction: column; }
        .fullscreen-canvas { flex: 1; width: 100%; height: 100%; }
        .fullscreen-controls { padding: 1rem; background: #1a1a1a; color: white; display: flex; justify-content: space-between; align-items: center; }
        
        @media (min-width: 768px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        }
        
        @media (min-width: 1024px) {
            .lg\:grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        const ShelterFormApp = () => {
          const [forms, setForms] = useState({});
          const [templates, setTemplates] = useState([]);
          const [view, setView] = useState('list');
          const [selectedForm, setSelectedForm] = useState(null);
          const [creatingForm, setCreatingForm] = useState(false);
          const [newFormName, setNewFormName] = useState('');
          const [newFormFields, setNewFormFields] = useState([]);
          const [currentEntry, setCurrentEntry] = useState({});
          const [editingEntry, setEditingEntry] = useState(null);

          useEffect(() => {
            const savedTemplates = localStorage.getItem('formTemplates');
            const savedForms = localStorage.getItem('formData');
            
            if (savedTemplates) {
              setTemplates(JSON.parse(savedTemplates));
            } else {
              const defaultTemplates = [
                {
                  id: 'daily-checkin',
                  name: 'Daily Check-In',
                  fields: [
                    { name: 'date', label: 'Date', type: 'date', required: true },
                    { name: 'name', label: 'First Name', type: 'text', required: true },
                    { name: 'surname', label: 'Surname', type: 'text', required: true },
                    { name: 'phone', label: 'Phone Number', type: 'tel', required: true },
                    { name: 'idNumber', label: 'ID Number', type: 'text', required: true },
                    { name: 'bedNumber', label: 'Bed Number', type: 'text', required: false },
                    { name: 'signature', label: 'Signature', type: 'signature', required: true },
                  ]
                }
              ];
              setTemplates(defaultTemplates);
              localStorage.setItem('formTemplates', JSON.stringify(defaultTemplates));
            }
            
            if (savedForms) {
              setForms(JSON.parse(savedForms));
            }
          }, []);

          const saveData = (newTemplates, newForms) => {
            if (newTemplates) {
              localStorage.setItem('formTemplates', JSON.stringify(newTemplates));
              setTemplates(newTemplates);
            }
            if (newForms !== undefined) {
              localStorage.setItem('formData', JSON.stringify(newForms));
              setForms(newForms);
            }
          };

          const createNewForm = () => {
            if (!newFormName.trim() || newFormFields.length === 0) {
              alert('Please provide a form name and at least one field');
              return;
            }

            const newTemplate = {
              id: Date.now().toString(),
              name: newFormName,
              fields: newFormFields
            };

            const updatedTemplates = [...templates, newTemplate];
            saveData(updatedTemplates, forms);
            setCreatingForm(false);
            setNewFormName('');
            setNewFormFields([]);
          };

          const addField = () => {
            setNewFormFields([...newFormFields, { name: '', label: '', type: 'text', required: false }]);
          };

          const updateField = (index, key, value) => {
            const updated = [...newFormFields];
            updated[index][key] = value;
            if (key === 'label' && !updated[index].name) {
              updated[index].name = value.toLowerCase().replace(/\s+/g, '_');
            }
            setNewFormFields(updated);
          };

          const removeField = (index) => {
            setNewFormFields(newFormFields.filter((_, i) => i !== index));
          };

          const deleteTemplate = (templateId) => {
            if (!confirm('Delete this form? All entries will be lost.')) return;
            const updatedTemplates = templates.filter(t => t.id !== templateId);
            const updatedForms = { ...forms };
            delete updatedForms[templateId];
            saveData(updatedTemplates, updatedForms);
          };

          const openForm = (template) => {
            setSelectedForm(template);
            setCurrentEntry({});
            template.fields.forEach(field => {
              if (field.type === 'date') {
                setCurrentEntry(prev => ({ ...prev, [field.name]: new Date().toISOString().split('T')[0] }));
              }
            });
            setView('entries');
          };

          const saveEntry = () => {
            const requiredFields = selectedForm.fields.filter(f => f.required);
            const missing = requiredFields.filter(f => {
              const value = currentEntry[f.name];
              // For signature fields, check if it's a valid data URL
              if (f.type === 'signature') {
                return !value || value.length < 100; // data URLs are long
              }
              return !value;
            });
            
            if (missing.length > 0) {
              alert('Please fill all required fields including signature');
              return;
            }

            const updatedForms = { ...forms };
            if (!updatedForms[selectedForm.id]) {
              updatedForms[selectedForm.id] = [];
            }

            if (editingEntry !== null) {
              updatedForms[selectedForm.id][editingEntry] = { ...currentEntry, updatedAt: new Date().toISOString() };
              setEditingEntry(null);
            } else {
              updatedForms[selectedForm.id].push({ ...currentEntry, id: Date.now(), createdAt: new Date().toISOString() });
            }

            saveData(null, updatedForms);
            setCurrentEntry({});
            // Reset signature fields
            selectedForm.fields.forEach(field => {
              if (field.type === 'date') {
                setCurrentEntry(prev => ({ ...prev, [field.name]: new Date().toISOString().split('T')[0] }));
              }
            });
          };

          const editEntry = (index) => {
            setEditingEntry(index);
            setCurrentEntry(forms[selectedForm.id][index]);
          };

          const deleteEntry = (index) => {
            if (!confirm('Delete this entry?')) return;
            const updatedForms = { ...forms };
            updatedForms[selectedForm.id].splice(index, 1);
            saveData(null, updatedForms);
          };

          const downloadExcel = (templateId) => {
            const template = templates.find(t => t.id === templateId);
            const entries = forms[templateId] || [];
            
            if (entries.length === 0) {
              alert('No entries to export');
              return;
            }

            const headers = template.fields
              .filter(f => f.type !== 'signature')
              .map(f => f.label);
            headers.push('Created At', 'Signed (Yes/No)');

            let csvContent = headers.join(',') + '\n';
            
            entries.forEach((entry, index) => {
              const row = template.fields
                .filter(f => f.type !== 'signature')
                .map(f => {
                  const value = entry[f.name] || '';
                  return `"${String(value).replace(/"/g, '""')}"`;
                });
              
              row.push(`"${new Date(entry.createdAt).toLocaleString()}"`);
              
              // Check if signature exists
              const signatureField = template.fields.find(f => f.type === 'signature');
              const hasSig = signatureField && entry[signatureField.name] && entry[signatureField.name].length > 100;
              
              // Add Yes/No column
              row.push(hasSig ? 'Yes' : 'No');
              
              csvContent += row.join(',') + '\n';
            });

            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${template.name.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
          };

          const updateFormName = (templateId, newName) => {
            const updatedTemplates = templates.map(t => 
              t.id === templateId ? { ...t, name: newName } : t
            );
            saveData(updatedTemplates, null);
          };

          return (
            <div className="container">
              <div className="max-w">
                <div className="pen-header">
                  <div className="pen-logo">PEN</div>
                  <div className="pen-tagline">Participate ‚Ä¢ Envision ‚Ä¢ Navigate</div>
                  <div className="text-sm" style={{ marginTop: '0.5rem' }}>Form Management System</div>
                </div>

                {view === 'list' && (
                  <div className="card">
                    <div className="flex justify-between items-center mb-6">
                      <h2 className="text-2xl font-bold text-gray-800">Your Forms</h2>
                      <button
                        onClick={() => setCreatingForm(true)}
                        className="btn btn-primary"
                      >
                        ‚ûï Create New Form
                      </button>
                    </div>

                    {creatingForm && (
                      <div className="mb-6 p-4 border-2 rounded-lg bg-pen-light border-pen">
                        <h3 className="font-semibold text-lg mb-4">Create New Form</h3>
                        <input
                          type="text"
                          placeholder="Form Name (e.g., Meal Request)"
                          value={newFormName}
                          onChange={(e) => setNewFormName(e.target.value)}
                          className="input mb-4"
                        />

                        <div className="space-y-3 mb-4">
                          {newFormFields.map((field, index) => (
                            <div key={index} className="flex gap-2 items-start bg-white p-3 rounded border">
                              <div className="flex-1">
                                <input
                                  type="text"
                                  placeholder="Field Label"
                                  value={field.label}
                                  onChange={(e) => updateField(index, 'label', e.target.value)}
                                  className="input mb-2"
                                />
                                <select
                                  value={field.type}
                                  onChange={(e) => updateField(index, 'type', e.target.value)}
                                  className="select"
                                >
                                  <option value="text">Text</option>
                                  <option value="date">Date</option>
                                  <option value="time">Time</option>
                                  <option value="tel">Phone</option>
                                  <option value="email">Email</option>
                                  <option value="textarea">Long Text</option>
                                  <option value="signature">Signature</option>
                                </select>
                              </div>
                              <label className="flex items-center gap-1 text-sm whitespace-nowrap">
                                <input
                                  type="checkbox"
                                  checked={field.required}
                                  onChange={(e) => updateField(index, 'required', e.target.checked)}
                                />
                                Required
                              </label>
                              <button
                                onClick={() => removeField(index)}
                                className="text-red-600 p-1"
                                style={{ background: 'none', border: 'none', cursor: 'pointer' }}
                              >
                                ‚úï
                              </button>
                            </div>
                          ))}
                        </div>

                        <div className="flex gap-2">
                          <button onClick={addField} className="btn btn-success">
                            + Add Field
                          </button>
                          <button onClick={createNewForm} className="btn btn-primary">
                            üíæ Save Form
                          </button>
                          <button
                            onClick={() => {
                              setCreatingForm(false);
                              setNewFormName('');
                              setNewFormFields([]);
                            }}
                            className="btn btn-light"
                          >
                            Cancel
                          </button>
                        </div>
                      </div>
                    )}

                    <div className="grid grid-2 lg:grid-cols-3">
                      {templates.map(template => {
                        const entryCount = forms[template.id]?.length || 0;
                        return (
                          <div key={template.id} className="border rounded-lg p-4 hover:shadow-md transition-shadow">
                            <h3 className="text-lg font-semibold text-gray-800 mb-2">{template.name}</h3>
                            <p className="text-sm text-gray-600 mb-1">{template.fields.length} fields</p>
                            <p className="text-sm text-blue-600 mb-4">{entryCount} entries</p>
                            <div className="flex gap-2">
                              <button
                                onClick={() => openForm(template)}
                                className="btn btn-primary flex-1"
                                style={{ fontSize: '0.875rem' }}
                              >
                                Open
                              </button>
                              {entryCount > 0 && (
                                <button
                                  onClick={() => downloadExcel(template.id)}
                                  className="btn btn-success"
                                  style={{ fontSize: '0.875rem' }}
                                  title="Download Excel"
                                >
                                  üìä
                                </button>
                              )}
                              <button
                                onClick={() => deleteTemplate(template.id)}
                                className="btn btn-danger"
                                style={{ fontSize: '0.875rem' }}
                                title="Delete Form"
                              >
                                üóëÔ∏è
                              </button>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                )}

                {view === 'entries' && selectedForm && (
                  <div className="card">
                    <div className="flex justify-between items-center mb-6">
                      <div>
                        <h2 className="text-2xl font-bold text-gray-800">{selectedForm.name}</h2>
                        <p className="text-sm text-gray-600">{forms[selectedForm.id]?.length || 0} entries</p>
                      </div>
                      <div className="flex gap-2">
                        {forms[selectedForm.id]?.length > 0 && (
                          <button
                            onClick={() => downloadExcel(selectedForm.id)}
                            className="btn btn-success"
                          >
                            üìä Download Excel
                          </button>
                        )}
                        <button
                          onClick={() => {
                            setView('list');
                            setSelectedForm(null);
                            setCurrentEntry({});
                            setEditingEntry(null);
                          }}
                          className="btn btn-gray"
                        >
                          ‚Üê Back to Forms
                        </button>
                      </div>
                    </div>

                    <div className="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                      <h3 className="font-semibold mb-3">
                        {editingEntry !== null ? 'Edit Entry' : 'New Entry'}
                      </h3>
                      <div className="space-y-4">
                        {selectedForm.fields.map(field => (
                          <div key={field.name}>
                            <label className="text-sm font-medium text-gray-700 mb-1" style={{ display: 'block' }}>
                              {field.label}
                              {field.required && <span className="text-red-500 ml-1">*</span>}
                            </label>
                            {field.type === 'signature' ? (
                              <SignatureField
                                value={currentEntry[field.name]}
                                onChange={(value) => setCurrentEntry({ ...currentEntry, [field.name]: value })}
                              />
                            ) : field.type === 'textarea' ? (
                              <textarea
                                value={currentEntry[field.name] || ''}
                                onChange={(e) => setCurrentEntry({ ...currentEntry, [field.name]: e.target.value })}
                                className="textarea"
                                rows="3"
                              />
                            ) : (
                              <input
                                type={field.type}
                                value={currentEntry[field.name] || ''}
                                onChange={(e) => setCurrentEntry({ ...currentEntry, [field.name]: e.target.value })}
                                className="input"
                              />
                            )}
                          </div>
                        ))}
                      </div>
                      <div className="flex gap-2 mt-4">
                        <button
                          onClick={saveEntry}
                          className="btn btn-success"
                        >
                          üíæ {editingEntry !== null ? 'Update' : 'Save'} Entry
                        </button>
                        {editingEntry !== null && (
                          <button
                            onClick={() => {
                              setEditingEntry(null);
                              setCurrentEntry({});
                            }}
                            className="btn btn-light"
                          >
                            Cancel
                          </button>
                        )}
                      </div>
                    </div>

                    <div className="space-y-3">
                      <h3 className="font-semibold text-lg">All Entries</h3>
                      {(!forms[selectedForm.id] || forms[selectedForm.id].length === 0) ? (
                        <p className="text-gray-500 py-8" style={{ textAlign: 'center' }}>No entries yet. Add one above!</p>
                      ) : (
                        forms[selectedForm.id].map((entry, index) => (
                          <div key={entry.id} className="border rounded-lg p-4 hover:bg-gray-50">
                            <div className="flex justify-between items-start mb-2">
                              <div className="flex-1">
                                <div className="grid md:grid-cols-2 gap-2 text-sm">
                                  {selectedForm.fields.filter(f => f.type !== 'signature').map(field => (
                                    entry[field.name] && (
                                      <div key={field.name}>
                                        <span className="font-medium text-gray-700">{field.label}:</span>{' '}
                                        <span className="text-gray-900">{entry[field.name]}</span>
                                      </div>
                                    )
                                  ))}
                                </div>
                                <p className="text-xs text-gray-500 mt-2">
                                  Created: {new Date(entry.createdAt).toLocaleString()}
                                  {(() => {
                                    const sigField = selectedForm.fields.find(f => f.type === 'signature');
                                    const hasSig = sigField && entry[sigField.name] && entry[sigField.name].length > 100;
                                    return hasSig ? ' ‚Ä¢ ‚úì Signed' : '';
                                  })()}
                                </p>
                              </div>
                              <div className="flex gap-2 ml-4">
                                <button
                                  onClick={() => editEntry(index)}
                                  className="text-blue-600 p-2"
                                  style={{ background: 'none', border: 'none', cursor: 'pointer' }}
                                  title="Edit"
                                >
                                  ‚úèÔ∏è
                                </button>
                                <button
                                  onClick={() => deleteEntry(index)}
                                  className="text-red-600 p-2"
                                  style={{ background: 'none', border: 'none', cursor: 'pointer' }}
                                  title="Delete"
                                >
                                  üóëÔ∏è
                                </button>
                              </div>
                            </div>
                          </div>
                        ))
                      )}
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        };

        const SignatureField = ({ value, onChange }) => {
          const canvasRef = useRef(null);
          const fullscreenCanvasRef = useRef(null);
          const [isDrawing, setIsDrawing] = useState(false);
          const [isFullscreen, setIsFullscreen] = useState(false);

          useEffect(() => {
            const canvas = canvasRef.current;
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (value && value.length > 100) {
              const img = new Image();
              img.onload = () => {
                ctx.drawImage(img, 0, 0);
              };
              img.src = value;
            }
          }, [value]);

          useEffect(() => {
            if (isFullscreen && fullscreenCanvasRef.current) {
              const canvas = fullscreenCanvasRef.current;
              const ctx = canvas.getContext('2d');
              
              // Set canvas to full window size
              canvas.width = window.innerWidth;
              canvas.height = window.innerHeight - 80; // Subtract controls height
              
              ctx.clearRect(0, 0, canvas.width, canvas.height);
              
              // Load existing signature if present
              if (value && value.length > 100) {
                const img = new Image();
                img.onload = () => {
                  const scale = Math.min(canvas.width / img.width, canvas.height / img.height);
                  const x = (canvas.width - img.width * scale) / 2;
                  const y = (canvas.height - img.height * scale) / 2;
                  ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
                };
                img.src = value;
              }
            }
          }, [isFullscreen, value]);

          const getCanvas = () => isFullscreen ? fullscreenCanvasRef.current : canvasRef.current;

          const startDrawing = (e) => {
            setIsDrawing(true);
            const canvas = getCanvas();
            const rect = canvas.getBoundingClientRect();
            const ctx = canvas.getContext('2d');
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;
            ctx.beginPath();
            ctx.moveTo(x, y);
          };

          const draw = (e) => {
            if (!isDrawing) return;
            e.preventDefault();
            const canvas = getCanvas();
            const rect = canvas.getBoundingClientRect();
            const ctx = canvas.getContext('2d');
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;
            ctx.lineTo(x, y);
            ctx.strokeStyle = '#000';
            ctx.lineWidth = isFullscreen ? 3 : 2;
            ctx.lineCap = 'round';
            ctx.stroke();
          };

          const stopDrawing = () => {
            if (isDrawing) {
              setIsDrawing(false);
              const canvas = getCanvas();
              onChange(canvas.toDataURL());
            }
          };

          const clearSignature = () => {
            const canvas = getCanvas();
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            onChange('');
          };

          const exitFullscreen = () => {
            setIsFullscreen(false);
            // Copy fullscreen signature to regular canvas
            setTimeout(() => {
              const regularCanvas = canvasRef.current;
              const ctx = regularCanvas.getContext('2d');
              ctx.clearRect(0, 0, regularCanvas.width, regularCanvas.height);
              if (value && value.length > 100) {
                const img = new Image();
                img.onload = () => {
                  ctx.drawImage(img, 0, 0, regularCanvas.width, regularCanvas.height);
                };
                img.src = value;
              }
            }, 50);
          };

          return (
            <div>
              <div className="border-2 rounded-lg bg-white relative" style={{ borderColor: '#d1d5db' }}>
                <canvas
                  ref={canvasRef}
                  width={600}
                  height={150}
                  className="w-full cursor-crosshair"
                  style={{ touchAction: 'none' }}
                  onMouseDown={startDrawing}
                  onMouseMove={draw}
                  onMouseUp={stopDrawing}
                  onMouseLeave={stopDrawing}
                  onTouchStart={startDrawing}
                  onTouchMove={draw}
                  onTouchEnd={stopDrawing}
                />
                <div className="absolute top-2 right-2 flex gap-2">
                  <button
                    type="button"
                    onClick={() => setIsFullscreen(true)}
                    className="btn btn-primary"
                    style={{ fontSize: '0.75rem', padding: '0.375rem 0.75rem' }}
                  >
                    ‚õ∂ Fullscreen
                  </button>
                  <button
                    type="button"
                    onClick={clearSignature}
                    className="btn btn-danger"
                    style={{ fontSize: '0.875rem' }}
                  >
                    ‚úï Clear
                  </button>
                </div>
              </div>
              <p className="text-xs text-gray-500 mt-1">Sign above using your mouse or finger</p>

              {isFullscreen && (
                <div className="fullscreen-overlay">
                  <div className="fullscreen-controls">
                    <div>
                      <div className="font-semibold">Sign Here</div>
                      <div className="text-xs" style={{ opacity: 0.8 }}>Use your finger or stylus</div>
                    </div>
                    <div className="flex gap-2">
                      <button
                        type="button"
                        onClick={clearSignature}
                        className="btn btn-danger"
                      >
                        ‚úï Clear
                      </button>
                      <button
                        type="button"
                        onClick={exitFullscreen}
                        className="btn btn-success"
                      >
                        ‚úì Done
                      </button>
                    </div>
                  </div>
                  <canvas
                    ref={fullscreenCanvasRef}
                    className="fullscreen-canvas cursor-crosshair"
                    style={{ touchAction: 'none' }}
                    onMouseDown={startDrawing}
                    onMouseMove={draw}
                    onMouseUp={stopDrawing}
                    onMouseLeave={stopDrawing}
                    onTouchStart={startDrawing}
                    onTouchMove={draw}
                    onTouchEnd={stopDrawing}
                  />
                </div>
              )}
            </div>
          );
        };

        ReactDOM.render(<ShelterFormApp />, document.getElementById('root'));
        
        // Service Worker Registration with proper caching
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            const swCode = `
const CACHE_NAME = 'pen-forms-v1';
const urlsToCache = [
  '/',
  'https://unpkg.com/react@18/umd/react.production.min.js',
  'https://unpkg.com/react-dom@18/umd/react-dom.production.min.js',
  'https://unpkg.com/@babel/standalone/babel.min.js'
];

self.addEventListener('install', function(event) {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(function(cache) {
        return cache.addAll(urlsToCache);
      })
  );
  self.skipWaiting();
});

self.addEventListener('activate', function(event) {
  event.waitUntil(
    caches.keys().then(function(cacheNames) {
      return Promise.all(
        cacheNames.map(function(cacheName) {
          if (cacheName !== CACHE_NAME) {
            return caches.delete(cacheName);
          }
        })
      );
    })
  );
  return self.clients.claim();
});

self.addEventListener('fetch', function(event) {
  event.respondWith(
    caches.match(event.request)
      .then(function(response) {
        if (response) {
          return response;
        }
        return fetch(event.request).then(function(response) {
          if (!response || response.status !== 200 || response.type !== 'basic') {
            return response;
          }
          const responseToCache = response.clone();
          caches.open(CACHE_NAME).then(function(cache) {
            cache.put(event.request, responseToCache);
          });
          return response;
        });
      })
  );
});
            `;
            
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swUrl)
              .then(registration => {
                console.log('Service Worker registered successfully');
              })
              .catch(error => {
                console.log('Service Worker registration failed:', error);
              });
          });
        }
    </script>
</body>
</html>